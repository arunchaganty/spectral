\appendix

\section{Directed models}
\label{sec:directedModels}

In the directed case, we assume a directed acyclic graph over $V$,
and define $\pi(j) \subset V$ to be the parents of each node $j \in V$.
Next, define a model as a product of locally-normalized models:
\begin{align}
  p_\theta(z) = \prod_{j \in V} p_\theta(z_j \mid z_{\pi(j)}), \quad\quad
  p_\theta(z_j \mid z_{\pi(j)}) = \exp \{ \phi_j(z_j, z_{\pi(j)})^\top\theta - A_j(\theta; z_{\pi(j)}) \}.
\end{align}
Here, each local model has its own local features $\phi_j(z_j, z_{\pi(j)})$
and its own local log-partition function $A(\theta; z_{\pi(j)})$, which depends on values of its parent.
To consolidate notation,
define $\phi(z) = \sum_{j \in V} \phi(z_j, z_{\pi(j)})$
and $A(\theta; z) = \sum_{j \in V} A_j(\theta; z_{\pi(j)})$,
so that:
\begin{align}
  p_\theta(z) \eqdef \exp\{ \phi(z)^\top\theta - A(\theta; z) \}. \aside{directed}
\end{align}

In this section, we describe parameter estimation in other models using our
framework.
a two-layer sigmoid belief network \cite{saul96sigmoid}.

\subsection{Directed mixture model}

In \refsecs{threeViewMixtureModel}{generalModels}, we focused for simplicity on
undirected models, but we parameter estimation in directed models is also
possible.
In the directed mixture model, we have
\begin{align}
p_\theta(x,h) = p_\theta(h) \prod_{j=1}^3 p_\theta(x_j \mid h),
\end{align}
where
$p_\theta(h) \eqdef \exp\{\phiprior(h)^\top\theta - \Aprior(\theta)\}$
and
$p_\theta(x_j \mid h) \eqdef \exp\{\philocal(x_j, h)^\top\theta - \Alocal(\theta; h)\}$.

Consequently, the joint log-likelihood is:
\begin{align}
  L(\theta) = {\underbrace{\E[\phi(x,h)]}_{\mu}}^\top\theta - \E[A(\theta; z)], \quad
  \E[A(\theta, z)] = \Aprior(\theta) + 3 \sum_{h \in [\nh]} \pi_h \Alocal(\theta;h).
\end{align}

Note that in directed models, the log-partition functions depends on the parent variables (in this case, $h$).
Having recovered the marginal distribution over $\pi$, we can compute the desired expectation.
Again, this problem is convex.

\subsection{Factorial hidden Markov models}

\Fig{figures/factorialHMM}{0.7}{factorialHMM}{
Parameter in a factorial HMM.
}

\cite{ghahramani97fhmm}
